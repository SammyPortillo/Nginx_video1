<html>
	<head>
		<link rel="icon" type="image/png" href="sam.ico">
	</head>

	<body>

	<h3>October 17 - 3</h3>
    <video id="video" controls></video>

    <script>
      const mediaSource = new MediaSource();
      video.src = URL.createObjectURL(mediaSource);
      mediaSource.addEventListener('sourceopen', sourceOpen, { once: true });
    
      function sourceOpen() {
        URL.revokeObjectURL(video.src);
        const sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs="vp8, vorbis"');
    
        // Fetch beginning of the video by setting the Range HTTP request header.
        fetch('media/video/big-buck-bunny_trailer.webm', { headers: { range: 'bytes=0-567139' } })
        .then(response => response.arrayBuffer())
        .then(data => {
          sourceBuffer.appendBuffer(data);
          sourceBuffer.addEventListener('updateend', updateEnd, { once: true });
        });
      }
    
      function updateEnd() {
        // Video is now ready to play!
        // video.addEventListener('playing', fetchNextSegment, { once: true });
        console.log(`31 video.buffered.length = ${video.buffered.length}`);
        // if (video.buffered.length === 0) return;
        const bufferedSeconds = video.buffered.end(0) - video.buffered.start(0);
        console.log(`${bufferedSeconds} seconds of video are ready to play.`);
    
        // Fetch the next segment of video when user starts playing the video.
        video.addEventListener('playing', fetchNextSegment, { once: true });
      }
    
      function fetchNextSegment() {
        fetch('media/video/big-buck-bunny_trailer.webm', { headers: { range: 'bytes=567140-1196488' } })
        .then(response => response.arrayBuffer())
        .then(data => {
          const sourceBuffer = mediaSource.sourceBuffers[0];
          sourceBuffer.appendBuffer(data);
          // TODO: Fetch further segment and append it.
        });
      }
    </script>

	</body>
</html>
